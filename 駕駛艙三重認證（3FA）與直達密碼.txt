V19-AUTH-Cockpit-3FA-01｜駕駛艙三重認證（3FA）與直達密碼
目標
 讓你能在「一般問答頁」用自然語言或主密碼「直達駕駛艙」，同時確保旁人難以枚舉/社工套問。三步皆是「對你有意義但不在個資中的祕鑰」。
0) 進入條件（兩條路，擇一）
* 自然語言觸發：訊息正文包含且只認關鍵詞「駕駛艙」→ 進入 3FA。

* 主密碼直達（Master Pass）：你輸入一串純字元密碼（部署時設定）。一旦偵測，立即跳轉駕駛艙，不經 3FA。（前端先截斷、不寫入聊天記錄；後端也會二次比對，但不落明文日誌。）

安全性：關鍵詞偵測與主密碼比對都採字面精確匹配，不依賴 LLM，避免「語意誤判」。
1) 三重挑戰（3FA）
Step-1｜二十選一（4 位數）
   * 介面顯示 20 組 4 位數候選（亂序顯示）。

   * 你輸入對你有意義的那一組（部署時由你指定哪一組是正解）。

   * 錯一次 → 凍結 3 分鐘（本步鎖定；前端倒數，後端拒收）。

Step-2｜再來二十選一（4 位數）
      * 格式同 Step-1，但為另一組 20 候選（與 Step-1 不重複）。

      * 錯一次 → 凍結 3 分鐘（本步鎖定）。

Step-3｜對映題（3 位數提示 → 你輸入對應值）
         * 螢幕顯示一個 3 位數提示（如 048）。

         * 你輸入其對應的應答碼（部署時設定）。

         * 錯一次 → 凍結 3 分鐘（本步鎖定）。

通過條件：3 步全部正確 → 發出一次性 cockpit_session_token，跳轉駕駛艙。
失敗處理：任一步失敗即停留在該步，待 3 分鐘後再試。不回傳哪裡錯，僅顯示「驗證未通過」。
部署要點（祕密管理）
            * 所有「正解」只以雜湊（BLAKE3/HMAC）形式儲存於安全變數服務（Vault/KMS），不入程式碼庫。

            * 20 個候選的「干擾碼」由安全 PRNG 即時生成，與正解不重覆；座位/裝置不同，亂序不同。

            * 伺服端日誌只記 成功/失敗、步驟序、時間、裝置 token，不記具體輸入值。

2) 前後端配合
               * 前端

                  * 偵測主密碼：在送出前本地比對（常數時間比較），命中則改為發出 request_cockpit() API，不把密碼寫進訊息流。

                  * 3FA UI：Step-1/2 顯示 20 個方塊（可點選或手動輸入 4 位數）；Step-3 顯示提示碼與輸入框。錯誤時顯示 3 分鐘倒數。

                     * 後端

                        * 所有比對皆為常數時間（防時序側通道）。

                        * 錯誤一律回「驗證未通過」，不暴露細節。

                        * 3 分鐘凍結以 device_token + seat + IP(/24) 維度鎖定；惡意連錯進入短暫降頻。

3) ADEG 與 3FA 的協同
                           * 即使在 3FA 途中，若對話文本帶有嘗試探知架構/繞過之語，ADEG 仍先攔截並回「原理級泛化」；不回任何內部細節。